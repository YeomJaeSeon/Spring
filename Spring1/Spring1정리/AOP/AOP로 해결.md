# 공통관심사항 시간측정이 핵심관심사항이랑 같이있어서 너무 힘들었지?

- AOP로 해결해보자.

- aop패키지를 만들어서 `TimeTraceAop` 클래스에서 AOP 만들었다.
- 여기서 공통관심사항(시간측정 로직)을 만들 것이다. aop를 통해서(spring에서 aop를 제공)
- 만들고 스프링빈으로 등록해야한다. 사실 aop는 정형화된 패턴보다는 공통관심사항, 특이한 케이스이므로 컴포넌트 스캔방식으로 스프링빈등록하는것보단 자바 코드로 설정파일로 스프링빈등록하는게 적절한데 여기선 걍 컴포넌트 스캔방식 사용하자.
- `@Around` 어노테이션으로 타겟을 정해준다.
- 무슨타겟이냐면 공통관심사항(aop)를 적용할 타겟. 우리는 hellospring아래 모든 클래스에 적용할것.
- 이렇게 공통관심사항을 따로 관리.

# 저번 문제들 -> AOP로 해결

- 시간조회하는 기능은 핵심 관심사항이아님. -> 공통관심사항, 핵심관심사항 분리함.
- 시간을 측정하는 로직은 공통관심사항임. ->분리한다음 타겟을 정할수있음!
- 시간을 측정하는 로직과 핵심비즈니스 로직이 섞여서 유지보수가 힘듬. -> 분리함.! 공통관심사항과 핵심관심사항을 분리
- 시간을 측정하는 로직을 별도의 공통로직으로 만들기 매우 어려움. (메서드안에 다 있어야하닌깡.) -> 공통로직을 만들엇다.(시간 측정하는)
- 시간을 측정하는 로직을 변경할때 모든 로직을 찾아가며 변경해야함. -> 변경이 필요하면 aop 이 공통관심사항 로직만 변경하면됨.

# AOP로 해결! 그런데 어케 공통관심사항인 AOP를 사용할수있는거지?(스프링 AOP 동작 방식)

- 가짜 프록시를 스프링 컨테이너에 스프링빈으로 등록해놓는다. (proxy)
- 그래서 스프링이 뜨면 프록시 memberService를 앞에 세운다!
- 그래서 만약 memberController가 가짜 memberService를 사용하면 가짜를 보내고 `joinPoint.proceed()`메소드를 가 실행되면 진짜 memberService를 실행한다.

- 이렇나 것들도 스프링의 DI덕분이다. 스프링 컨테이너에서 스프링빈으로 등록되어져 있으니 가능한것.

- getClass()로 실제로 프록시가 주입되나 확인해보면 `hello.hellospring.service.MemberService$$EnhancerBySpringCGLIB$$c306fd31`
- 뭐 요상한 클래스가 찍히는데 이게 proxy이다.!
