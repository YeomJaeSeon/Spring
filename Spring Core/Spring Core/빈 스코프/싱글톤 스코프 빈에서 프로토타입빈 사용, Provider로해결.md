# 싱글톤 스코프 빈내에서 프로토타입빈 사용

- 프로토타입 스코프 빈은 빈조회할때마다 새로운 빈을 받아야하는데 싱글톤 스코프 빈내에서 이미 의존관계 완료된 프로토타입 빈을 사용하니 새로운 빈을 사용하는게아닌 싱글턴 객체를 사용하는걸 느꼈다.
- 이를 해결하기 위해선 DL을 해주는 스프링에서 제공해주는 `ObjectFactory`, `ObjectProvider`를 사용하면된다.
- 물론 이러한 DL해주는 인터페이스 사용하지않고 어플리케이션 컨텍스트(스프링 컨테이너)자체를 이용해서 프로토타입빈 을 사용할떄마다 새롭게 받으면된다. 그러나 이 코드는 스프링컨테이너인 어플리케이션 컨텍스트에 너무 의존적이라 좋지않다.(단위테스트할떄 힘들다.)

# ObjectProvider, ObjectFactory

- 해당 인터페이스의 메서드 getObject()를 이용해서 DL을 할수있따.
- 여기서 DL이란 Dependency Lookup으로 DI와는 다르게 의존관계를 외부에서 주입받는게 아닌 자신이 직접 스프링 컨테이너 내에서 필요한 의존관계를 찾는 행위를 말한다.
- ObjectProvider는 ObjectFactory의 자식 인터페이스로 단순히 DL서비스 뿐만아니라 더많은 기능을 제공한다.
- 물론 위 인터페이스는 프로토타입빈을 사용하는데 특화된 인터페이스가아니라 Dependency Lookup을 하는데 사용되는 인터페이스이고 DL을 하면 프로토타입빈을 싱글톤 스코프 빈내에서 제대로 사용할수있는 장점이 존재하는 것이다.
- 그러나 스프링에서 제공하므로 스프링에 의존적이다.

# JSR-330 Provider

- 자바표준인 `JSR-330 Provider`를 이용하면 스프링에 의존적이지 않게 DL을 이용할수있다.
- 라이브러리를 외부에서 직접 받아야 사용할수있는단점이있다.
- 단순히 DL만 제공하므로 단순하고 간단하다!

# 정리

- 프로토타입빈은 매번 사용할 때마다 의존관계 주입이 완료된 **새로운** 객체가 필요할때 사용하면되는데 싱글턴 스코프 빈으로 해결이 가능한부분이므로 자주 사용되진않는다.
- ObjectProvider, Provider는 DL이 필요할떄 사용하자
