# 스코프 빈에대해서 공부중

- 싱글톤 스코프 빈은 스프링 빈 default 생명 범위로 스프링 컨테이너가 스프링 빈 등록부터 소멸까지 관리하고 프로토타입 빈은 스프링빈 등록부터 의존관계주입까지(정확힌 초기화 콜백) 관리하고 그이후에는 클라이언트 코드에 책임을 던진다는걸 배웠다. 그러므로 프로토타입 빈을 사용하면 해당 빈은 클라이언트가 요청할떄마다, 조회할때마다 새로운 빈을 생성해준다.

# 의문

- 그러면 싱글톤 빈 내에서 프로토타입빈을 사용하면?
- 어렵지않다. 스프링 빈 의존관계 주입되는 과정을 생각하면 싱글톤 빈내에서 사용하는 프로토타입빈이 하나의 객체로 존재하는지, 사용할때마다 새로운 객체를 생성하는지 찾을수있다.
- 이런 과정을 생각하는 이유는 **스프링 빈은 기본적으로 싱글톤 스코프 빈이므로 싱글톤 스코프 빈이 프로토타입 빈을 사용하는경우가 잦기 때문이다.**
- 일단 코드를 봐보자

```
    @Scope("singleton")
    @RequiredArgsConstructor // 생성자주입으로 의존관계 주입받는다.
    static class ClientBean{
        private final PrototypeBean prototypeBean;

        public int logic(){
            prototypeBean.addCount();
            int count = prototypeBean.count;
            return count;
        }
    }
```

- `@Scope("singleton")`으로 싱글턴 빈으로 지정하지않아도 싱글톤 스코프 빈이지만 그냥 썼다.
- 해당 빈을 등록하기 위한 스프링 컨테이너 생성코드는 `AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(ClientBean.class, PrototypeBean.class);` 이러하고 `PrototypeBean`은 프로토타입 빈이다.
- 이코드를 실행하면 스프링 컨테이너가 생성되고 두개의 스프링빈이 등록되고 의존관계 주입이된다. 그런데 이때~ 싱글톤 스코프 빈인 `ClientBean`빈은 생성자 주입시(스프링 빈 등록시)에 프로토타입 빈 의존관계 주입을 마친다. 아무리 프로토타입 빈이라도 의존관계 주입이 완료된 프로토타입 빈에 대해서는 계속해서 해당 참조변수의 값을 사용하는것이다. 자바 코드적인 부분을 생각하면된다. 생성자 주입이후 필드(참조변수)가 가르키는 실제 객체는 프로토타입빈의 객체이다.
- 이 이후 싱글톤 스코프 빈인 `ClientBean`을 여러번 조회해도 같은 빈이 조회되는건 당연한거고 해당 빈들은 당연히 내부적으로 가지고있는 프로토타입 객체(참조변수)는 같다.
- 그러므로 아무리 프로토타입 빈을 사용하더라도 같은 프로토타입빈 객체에 접근하는것이다.
- 그런데 우리는 프로토타입빈을 왜사용하나?
- 바로 프로토타입 빈 조회할때마다 새로운 객체를 받고싶어서이다.
- 그런데 그게 잘되지가 않는다.
- 이 해결책은 다음시간에 해결해보자

# 결론

1. 스프링빈은 default로 싱글턴 스코프 스프링 빈이다.
2. 싱글턴 스코프 스프링빈이 프로토타입 빈을 사용하는 경우는 잦다
3. 싱글턴 스코프 스프링 빈이 의존관계 주입하여 내부적으로 가지고있는 프로토타입 빈에 대해서는 이미 주입이 끝난 빈이므로 같은 객체에 참조한다.(여러 싱글톤 스프링 빈 객체가 생성되어도, 즉 여러 클라이언트가 해당빈을 조회해도)
