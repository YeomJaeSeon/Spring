# HTTP API 설계예시

1. HTTP API - 컬렉션

- **POST** 기반 등록
- ex)회원 관리 API제공

2. HTTP API - 스토어

- **PUT** 기반 등록
- ex) 정적 컨텐츠 관리, 원격 파일관리
  (뭔가 완전 대체할때.)

3. HTML FORM 사용

- 웹페이지 회원관리
- GET, POST만 지원됨.

이 세개의 예시를 구체적으로 살펴보자.

# HTTP API설계 - POST기반 등록을 중점으로봐보자.

잠깐! URI설계할떄 리소스만 식별가능해야하고 나머지는 HTTP 메서드를 통해서하는게 좋다했지? 사실 이건 너무이상적이다. 실세계에선 이것만으로 URI를 설계하는것이 불가능하다.

- 회원 목록 : /members -> GET (전체 목록을 조회하는 API URI이다. 쿼리 파라미터를 통해서 정렬 필터검색등이 가능하겠다.)
- 회원 등록 : /members -> POST (POST로 요청한 데이터와 함께 등록해달라한다. 어? 여기 클라이언트에선 리소스 식별이 안되네. 이유는 뒤에서..)
- 회원 조회 : /members/{id} -> GET (조회니 당연히 GET이고 한명조회니 리소스 식별할 정확한 위치를 포함해준다.)
- 회원 수정 : /members/{id} -> PATCH, PUT, POST : 정확한 리소스 식별위치를 알아야 수정할수있으니 리소스 식별위치 넣어주고 어떻게 수정하냐에따라서 부분만 변경하면 PATCH, 완전 대체(게시글 다시올리는거 ..)하면 PUT, 그외 애매한건 POST로 수정..
- 회원 삭제 : /members/{id} => DELETE (당연히 삭제니 DELETE 메서드로 리소스 삭제하고 회원한명삭제하므로 리소스 한명 식별할 위치를 서버로전달.)

## POST메서드로 신규 등록 할때 특징

- 위의 예시에서 회원 등록에서 API URI설계를 /members로만 하였고 POST HTTP메서드를 이용하여 등록을 식별했다.
- 보면 리소스가 등록될 정확한 위치를 지정하지않았다. 즉 클라이언트는 리소스의 UIR를 모른다.
- 서버가 새로 등록된 리소스 URI를 새로생성해준다.

/members -> 로 요청하면 서버에선 /members/100에 POST왔으니 등록할게~하고 등록하고 HTTP Response Message의 HTTP Header에 `Location: /members/100`이라고 응답한다.

- 이렇게 POST로 신규 등록하는 건 **서버가 새로 등록된 리소스의 URI를 등록**한다는 특징이 있다.
- 즉, 서버가 리소스의 위치를 관리한다.

- 이걸 **컬렉션**이라한다.

### 컬렉션

- 서버가 관리하는 리소스 디렉토리를 의미한다.
- 서버가 리소스의 URI를 생성하고 관리한다.(클라이언트는 모름)
- 여기선 `/members`가 컬렉션이다.

## HTTP API 설계 - PUT 기반 등록을중점적으로 봐보자. 그리고POST기반 컬렉션과의 차이를 중점적으로 살피자.

- 파일 목록 : /files -> GET (파일목록 조회하고싶으므로 GET 메서드 사용하는데 필터등 다양한 기능을하고싶으면 쿼리파라미터로 조건을 추가해서 전달)
- 파일 조회 : /files/{filename} ->GET (하나의 파일 조회할때이므로 리소스 식별할 정확한위치를 서버로 전달)
- 파일 등록 : /files/{filename} -> PUT -> 파일을 등록하는 것이므로 완전대체하는 PUT메서드가 적절하고 이땐 리소스 식별할 정확한 위치를 클라이언트에서 서버로 전달한다.(즉 클라이언트에서 리소스 URI를 생성하고 관리한다.)
- 파일 삭제 : /files/{filename} -> DELETE -> 삭제하므로 DELETE메서드, 파일 리소스 식별해야하므로 정확한 리소스 위치도 포함해서 전달
- 파일 대량 등록 : /files -> POST : POST경우는 임의로 어떠한 기능을 설정할수잇음 . 파일 대량 등록은 하나의 예시임

## PUT메서드로 신규등록할때특징

- 보면 파일 등록할때 API URI는 /files/{filename} 으로 PUT메서드를 이용한다
- 파일을 등록하니 완전대체하는 메서드인 PUT이 적절한데 보면 클라이언트가 리소스 식별 위치를 생성해서 전달한다. (POST는 클라이언트는 리소스 식별 위치를 모르고 POST로 요청하면 서버에서 리소스 식별위치 생성했다.)
- PUT의 ex) PUT /files/star.jpg 이렇게 리소스 식별할 정확한 위치를 전달한다. 클라이언트에서..
- 즉 **클라이언트에서 직접 리소스의 URI를 지정한다.**

### 스토어

- 클라이언트가 관리하는 리소스 저장소를 스토어라고함.
- 클라이언트가 리소스의 URI를 알고 관리를 한다.
- 여기서 스토어는 /files

## 컬렉션 vs 스토어

- 컬렉션은 서버에서 리소스 URI를 생성하고 관리한다.
- 스토어는 클라이언트에서 리소스 URI를 알고 관리한다.
- 컬렉션은 POST메서드로 신규등록할때이다.
- 스토어는 PUT메서드로 신규등록할때이다.

- 저저저번에 PUT과 POST를 배울때 차이로는 PUT은 클라이언트에서 리소스 식별할 위치를 알고있고 POST는 클라이언트에서 리소스 식별위치를 모른다고 배웠다. 추가로 멱등의차이도있음(POST는 멱등 X, PUT은 멱등 O)
- 참고로 컬렉션이 훨씬 많이사용됨

## HTML FORM사용할때 API설계

- HTML FORM의 HTTP API설계하기전에 HTML FORM은 HTTP 메서드를 GET , POST만 지원한다는걸 알고들어가자. 어 그러면 리소스와 HTTP 메서드만으로 URI설계까 어렵겟네.. 그러면 컨트롤 URI(동사를 URI에 포함)를 사용해야겠네? 라는 생각까지 해야한다.

- 회원 목록 : /members -> GET
- 회원 등록 폼 : /members/new -> GET
  위 두개는 그냥 링크타고 페이지 조회하는거다. GET으로.
- 회원 등록 : /members/new, /members -> POST(URI를 설계할때 두가지방법으로가능 전자는 회원등록폼 URI와 맞추기 후자는 컬렉션처럼 /복수형 맞추기)
  ...
  암튼 이렇게하면됨

## HTML FORM사용 API URI특징

- GET, POST메서드만 사용가능
- 컨트롤 URI (컨트롤러)

1. GET POST만 있으므로 제약이있다.
2. 이런 제약을 해소하기 위해 동사로 된 리소스 경로를 사용(리소스 식별만 하기위한 URI의 약속을 어긴건데 어쩔수없음. 현실 세계는 복잡함.)
3. POST의 /new, /edit, /delete같은 경우가 URI에 동사가 붙은 컨트롤 URI, 컨트롤러라고함.
4. HTTP 메서드로 해결하기 어려운경우에 사용하는데 HTTP FORm뿐만 아니라 HTTP API(GET POST PUT DELTE .. 모두 지원해도) 를 사용해도 컨트롤 URI로 URI에 동사붙일 경우가 무조건생긴다.

# 정리

- HTTP API - 컬렉션

1. POST기반등록
2. 서버가 리소스 URI결정(관리, 생성)

- HTTP API - 스토어

1. PUT기반등록
2. 클라이언트가 리소스 URI 결정

- HTML FORM 사용

1. GET POST만지원
2. 컨트롤 URI사용할 경우가 꽤많음 다른 경우보다.(GET POST만 지원하므로 리소스만을 식별할 URI는 턱없이 부족.)

# 참고!

- Document(문서)

1. 단일 개념(파일하나, 객체 인스턴스, db record)
2. ex) /members/100, /files/star.jpg같은 하나

- 컬렉션(collection)

1. 서버가 관리하는 리소스 디렉토리
2. 서버가 리소스 URI생성하고 관리
3. 스토어보단 거의 컬렉션을 사용
   ex) /members

- 스토어(Store)

1. 클라이언트가 관리하는 자원 저장소
2. 클라이언트가 리소스의 URI생성하고 관리
   ex) /files

- 컨트롤러, 혹은 컨트롤URI

1. 문서, 컬렉션, 스토어 만으로 해결하기 어려운 경우에 사용(URI에 동사붙임)
2. 동사를 직접사용한다.(URI는 원리 리소스만식별하고 동사나 행위는 HTTP메서드로하는게 원칠이다.)
3. /members/{id}/delete
